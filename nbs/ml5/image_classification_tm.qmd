---
title: "Clasificador de Video con Teachable Machine"
description: "Este es un modelo entrenado en Teachable Machine que clasifica im√°genes en tiempo real usando la c√°mara."
format: html
---

Este modelo utiliza un clasificador entrenado en Teachable Machine para analizar im√°genes capturadas desde una c√°mara web en tiempo real. El clasificador puede identificar patrones visuales definidos durante el entrenamiento del modelo y producir una predicci√≥n continua a partir del video.

**Instrucciones:**

- 1. Haz clic en el bot√≥n "Iniciar Clasificador de Video"

- 2. Permite el acceso a la c√°mara cuando el navegador lo solicite

- 3. Ver√°s la etiqueta detectada y un emoji que representa la predicci√≥n actual

::: {.callout-note}
Este ejemplo usa video en tiempo real como entrada. El modelo puede clasificar continuamente los frames capturados por la c√°mara web.
:::

<div id="button-container" style="text-align: center; margin: 20px 0;">
  <button id="start-button" style="padding: 12px 24px; font-size: 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
    Iniciar Clasificador de Video
  </button>
  <button id="stop-button" style="display: none; padding: 12px 24px; font-size: 16px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">
    Cerrar Clasificador
  </button>
  <p id="status-message" style="margin-top: 10px; font-style: italic; color: #666;"></p>
</div>

<div id="p5-sketch" style="display: none; text-align: center;">
  <div id="canvas-container" style="display: inline-block;"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/p5@1.11.7/lib/p5.js"></script>
<script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>

<script>
// Esperar a que ml5 est√© completamente cargado
window.addEventListener('load', function() {
    if (typeof ml5 === 'undefined') {
        console.error('ml5 no est√° cargado');
        return;
    }

    const startButton = document.getElementById('start-button');
    const stopButton = document.getElementById('stop-button');
    const statusMessage = document.getElementById('status-message');
    const sketchContainer = document.getElementById('p5-sketch');
    let sketchStarted = false;
    let p5Instance = null;

    startButton.addEventListener('click', function() {
        if (sketchStarted) return;

        sketchStarted = true;
        startButton.style.display = 'none';
        stopButton.style.display = 'inline-block';
        statusMessage.textContent = 'Cargando modelo...';
        sketchContainer.style.display = 'block';

        const sketch = (p) => {
            // Inicializar el clasificador de im√°genes
            let classifier;

            // Video capturado desde la c√°mara
            let video;

            // Etiqueta detectada
            let label = "";

            // URL del modelo entrenado en Teachable Machine
            const modelURL = "https://teachablemachine.withgoogle.com/models/bXy2kDNi/";

            p.preload = function() {
                classifier = ml5.imageClassifier(modelURL);
            }

            p.setup = function() {
                p.createCanvas(640, 520);
                statusMessage.textContent = 'Clasificando video...';
                statusMessage.style.color = '#4CAF50';

                video = p.createCapture(p.VIDEO);
                video.hide();

                classifier.classify(video, gotResult);
            }

            function gotResult(error, results) {
                if (error) {
                    console.error(error);
                    statusMessage.textContent = 'Error al clasificar el video';
                    statusMessage.style.color = '#f44336';
                    return;
                }

                label = results[0].label;
                classifier.classify(video, gotResult);
            }

            p.draw = function() {
                p.image(video, 0, 0, p.width, p.height);

                p.fill(255);
                p.stroke(0);
                p.strokeWeight(2);
                p.textSize(18);
                p.text("Etiqueta: " + label, 10, p.height - 20);

                let emoji = "ü´∑";
                if (label === "noche") {
                    emoji = "‚òΩ";
                } else if (label === "d√≠a") {
                    emoji = "üåû";
                }

                p.textSize(200);
                p.textAlign(p.CENTER, p.CENTER);
                p.text(emoji, p.width / 2, p.height / 2);
            }
        };

        p5Instance = new p5(sketch, 'canvas-container');
    });

    stopButton.addEventListener('click', function() {
        if (p5Instance) {
            p5Instance.remove();
            p5Instance = null;
        }

        sketchContainer.style.display = 'none';
        stopButton.style.display = 'none';
        startButton.style.display = 'inline-block';
        statusMessage.textContent = '';
        sketchStarted = false;
    });
});
</script>

## Explicaci√≥n del C√≥digo

### C√≥digo Completo

```javascript
// Clasificador de im√°genes cargado desde Teachable Machine
let classifier;

// Video capturado en tiempo real desde la c√°mara web
let video;

// Etiqueta resultante de la clasificaci√≥n
let label = "";

// URL del modelo entrenado en Teachable Machine
const modelURL = "https://teachablemachine.withgoogle.com/models/bXy2kDNi/";

// Se ejecuta antes de setup() y se usa para cargar recursos
function preload() {
    // Cargar el modelo de clasificaci√≥n entrenado previamente
    classifier = ml5.imageClassifier(modelURL);
}

function setup() {
    // Crear el lienzo donde se mostrar√° el video
    createCanvas(640, 520);

    // Activar la c√°mara y capturar el video
    video = createCapture(VIDEO);

    // Ocultar el elemento HTML del video (solo se usa el canvas)
    video.hide();

    // Iniciar la primera clasificaci√≥n del video
    classifier.classify(video, gotResult);
}

// Funci√≥n callback que se ejecuta cuando el modelo entrega un resultado
function gotResult(error, results) {
    // Verificar si ocurri√≥ un error durante la clasificaci√≥n
    if (error) {
        console.error(error);
        return;
    }

    // Guardar la etiqueta m√°s probable
    label = results[0].label;

    // Volver a clasificar el siguiente frame del video
    classifier.classify(video, gotResult);
}

function draw() {
    // Dibujar el video en el lienzo
    image(video, 0, 0, width, height);

    // Configurar el estilo del texto
    fill(255);
    stroke(0);
    strokeWeight(2);
    textSize(18);

    // Mostrar la etiqueta detectada en pantalla
    text("Etiqueta: " + label, 10, height - 20);
}


### 1. Declaraci√≥n de Variables

Primero, declaramos las variables que necesitaremos durante todo el proceso:

```javascript
// Clasificador de im√°genes cargado desde Teachable Machine
let classifier;

// Video capturado en tiempo real desde la c√°mara web
let video;

// Etiqueta resultante de la clasificaci√≥n
let label = "";

// URL del modelo entrenado en Teachable Machine
const modelURL = "https://teachablemachine.withgoogle.com/models/bXy2kDNi/";
````

### 2. Carga del Modelo (preload)

La funci√≥n `preload()` se ejecuta antes de `setup()` y es ideal para cargar recursos:

```javascript
function preload() {
    classifier = ml5.imageClassifier(modelURL);
}
```

### 3. Configuraci√≥n Inicial (setup)

La funci√≥n `setup()` se ejecuta una vez al inicio:

```javascript
function setup() {
    createCanvas(640, 520);
    video = createCapture(VIDEO);
    video.hide();
    classifier.classify(video, gotResult);
}
```

### 4. Procesamiento de Resultados

La funci√≥n `gotResult` es un callback que recibe los resultados de la clasificaci√≥n:

```javascript
function gotResult(error, results) {
    if (error) {
        console.error(error);
        return;
    }
    label = results[0].label;
    classifier.classify(video, gotResult);
}
```

### 5. Visualizaci√≥n del Resultado (draw)

La funci√≥n `draw()` se ejecuta varias veces por segundo:

```javascript
function draw() {
    image(video, 0, 0, width, height);
    fill(255);
    stroke(0);
    strokeWeight(2);
    textSize(18);
    text("Etiqueta: " + label, 10, height - 20);
}
```